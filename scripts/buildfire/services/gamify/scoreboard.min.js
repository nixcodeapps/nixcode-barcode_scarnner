if("undefined"==typeof buildfire)throw"please add buildfire.js first to use BuildFire services";buildfire.gamify||(buildfire.gamify={}),buildfire.gamify.Scoreboard=function(e,i,t){this.size=i||10,this.autoSubscribeToPushNotification=t,this.size<1&&(this.size=10),this.tagName=e||"scoreboard",this.pushGroupName="scoreboard_"+this.tagName},buildfire.gamify.Scoreboard.prototype={size:10,getScoreboard:function(t){buildfire.publicData.get(this.tagName,function(e,i){e?t(e):i.data.topScores?t(void 0,i.data):t(void 0,{gamesPlayed:0,topScores:[]})})},reset:function(){buildfire.publicData.save({gamesPlayed:0,topScores:[]},this.tagName,function(){})},_PNEnabled:function(){return buildfire.notifications&&buildfire.notifications.pushNotification},subscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.subscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},unsubscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.unsubscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},logScore:function(c,d,f){this.autoSubscribeToPushNotification&&(this.subscribe()||console.warn("Cannot subscribe to scoreboard push notifications because buildfire push notification services is not attached"));var l=this,p=new Date;buildfire.publicData.get(this.tagName,function(e,i){function t(e){e&&f(e)}var o={user:c,score:d,createdOn:p},a={gamesPlayed:0,topScores:[o]};if(e)f(e);else if(i)if(i.data.topScores){var s,r;i.data.topScores.length>l.size&&i.data.topScores[l.size-1].score>d&&f(),(a=i.data).topScores.push(o),a.topScores=a.topScores.sort(function(e,i){return i.score-e.score}),a.topScores.length>l.size&&(s=a.topScores.pop()),a.gamesPlayed++,buildfire.publicData.update(i.id,a,l.tagName,t);for(var u=0;u<a.topScores.length;u++)if(a.topScores[u].createdOn==p){r=u;break}var n={bumpedOff:s,rankedAt:r};l._PNEnabled()&&(n.bumpedOff&&n.bumpedOff.user.email!=c.email&&buildfire.notifications.pushNotification.schedule({title:"You got kicked off !!!",text:"Your old score is no longer on the top 10. "+c.displayName+" has taken your spot. Honestly, I dont know how you sleep at night.",users:[n.bumpedOff.user.id]},t),0==r&&buildfire.notifications.pushNotification.schedule({title:"There is a new champion!",text:c.displayName+" has taken the lead at the new undisputed champion with a score of "+d,groupName:l.pushGroupName},t),1==r&&buildfire.notifications.pushNotification.schedule({title:"There is a challenger to the champion",text:c.displayName+" has taken 2nd place with a score of "+d+". Watch out "+a.topScores[0].user.displayName,groupName:l.pushGroupName},t),2==r&&buildfire.notifications.pushNotification.schedule({title:"There is a kid in town!",text:c.displayName+" has taken 3rd place. Keep an eye on this one",groupName:l.pushGroupName},t)),f(null,n)}else a.gamesPlayed++,buildfire.publicData.save(a,l.tagName,t);else a.gamesPlayed++,buildfire.publicData.save(a,l.tagName,t),f(null,{rankedAt:0})})}};
//# sourceMappingURL=scoreboard.min.js.map
